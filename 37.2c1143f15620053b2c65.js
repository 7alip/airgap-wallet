(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{awK3:function(t,e,n){"use strict";n.r(e),n.d(e,"LedgerSignPageModule",(function(){return M}));var r=n("138U"),i=n("ofXK"),o=n("tyNb"),a=n("TEn/"),s=n("sYmb"),c=n("j1ZV"),b=n("iTUp"),l=n("mrSG"),u=n("IVSH"),d=n("kB5k"),h=n.n(d),p=n("1y+R"),g=n("z26V"),f=n("hPkG"),m=n("fXoL"),v=function(t){return{protocol:t,maxDigits:void 0}},w=function(t){return{protocol:t}};function N(t,e){if(1&t&&(m.Lb(0),m.Nb(1,"ion-row",9),m.Nb(2,"ion-col",10),m.Nb(3,"h5"),m.uc(4),m.Yb(5,"async"),m.Yb(6,"amountConverter"),m.Mb(),m.Mb(),m.Nb(7,"ion-col",10),m.Nb(8,"h5"),m.uc(9),m.Mb(),m.Mb(),m.Nb(10,"ion-col",10),m.Nb(11,"h5"),m.uc(12),m.Yb(13,"async"),m.Yb(14,"feeConverter"),m.Mb(),m.Mb(),m.Nb(15,"ion-col",11),m.Nb(16,"small"),m.uc(17,"Amount"),m.Mb(),m.Mb(),m.Nb(18,"ion-col",11),m.Nb(19,"small"),m.uc(20,"Operations"),m.Mb(),m.Mb(),m.Nb(21,"ion-col",11),m.Nb(22,"small"),m.uc(23,"Fee"),m.Mb(),m.Mb(),m.Mb(),m.Kb()),2&t){var n=m.Xb();m.yb(4),m.wc(" ",m.Zb(5,3,m.ac(6,5,n.aggregatedInfo.totalAmount.toFixed(),m.hc(13,v,n.airGapTxs[0].protocolIdentifier)))," "),m.yb(5),m.vc(n.aggregatedInfo.numberOfTxs),m.yb(3),m.vc(m.Zb(13,8,m.ac(14,10,n.aggregatedInfo.totalFees.toFixed(),m.hc(15,w,n.airGapTxs[0].protocolIdentifier))))}}function y(t,e){1&t&&m.Jb(0,"airgap-from-to",13),2&t&&m.dc("transaction",e.$implicit)}function I(t,e){if(1&t&&(m.Lb(0),m.sc(1,y,1,1,"airgap-from-to",12),m.Kb()),2&t){var n=m.Xb();m.yb(1),m.dc("ngForOf",n.airGapTxs)}}var T=function(t){return{title:t}},x=function(){function t(t,e,n,r,i,o,a){var s=this;if(this.router=t,this.route=e,this.dataService=n,this.alertCtrl=r,this.loadingController=i,this.translateService=o,this.ledgerService=a,this.wallet=null,this.airGapTxs=null,this.route.snapshot.data.special){var c=this.route.snapshot.data.special;this.wallet=c.wallet,this.airGapTxs=c.airGapTxs,this.unsignedTx=c.data,this.airGapTxs.length>1&&this.airGapTxs.every((function(t){return t.protocolIdentifier===s.airGapTxs[0].protocolIdentifier}))&&(this.aggregatedInfo={numberOfTxs:this.airGapTxs.length,totalAmount:this.airGapTxs.map((function(t){return new h.a(t.amount)})).filter((function(t){return!t.isNaN()})).reduce((function(t,e){return t.plus(e)}),new h.a(0)),totalFees:this.airGapTxs.reduce((function(t,e){return t.plus(e.fee)}),new h.a(0))},console.log("aggregatedInfo",this.aggregatedInfo))}this.connectWithLedger()}return t.prototype.connectWithLedger=function(){return Object(l.b)(this,void 0,void 0,(function(){var t;return Object(l.e)(this,(function(e){switch(e.label){case 0:return[4,this.showLoader("Connecting device...")];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,5,6]),[4,this.ledgerService.openConnection(this.wallet.protocol.identifier)];case 3:return e.sent(),[3,6];case 4:return t=e.sent(),console.warn(t),this.promptError(t),[3,6];case 5:return this.dismissLoader(),[7];case 6:return[2]}}))}))},t.prototype.signTx=function(){return Object(l.b)(this,void 0,void 0,(function(){var t,e,n;return Object(l.e)(this,(function(r){switch(r.label){case 0:return[4,this.showLoader("Signing transaction...")];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,5,6]),[4,this.ledgerService.signTransaction(this.wallet.protocol.identifier,this.unsignedTx)];case 3:return t=r.sent(),e={id:Object(u.generateId)(10),type:u.IACMessageType.MessageSignResponse,protocol:this.wallet.protocol.identifier,payload:{transaction:t,accountIdentifier:this.wallet.publicKey.substr(-6)}},this.dataService.setData(p.b.TRANSACTION,{signedTransactionsSync:[e]}),this.router.navigateByUrl("/transaction-confirm/"+p.b.TRANSACTION).catch(Object(f.b)(f.a.NAVIGATION)),[3,6];case 4:return n=r.sent(),console.warn(n),this.promptError(n),[3,6];case 5:return this.dismissLoader(),[7];case 6:return[2]}}))}))},t.prototype.promptError=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.e)(this,(function(n){switch(n.label){case 0:if("string"==typeof t){if("Rejected"===t)return[2];e=t}else e=t instanceof Error?t.message:this.translateService.instant("ledger-sign.error-alert.unknown");return[4,this.alertCtrl.create({header:this.translateService.instant("ledger-sign.error-alert.header"),message:e,buttons:[{text:this.translateService.instant("ledger-sign.error-alert.confirm")}]})];case 1:return n.sent().present().catch(Object(f.b)(f.a.IONIC_ALERT)),[2]}}))}))},t.prototype.showLoader=function(t){return Object(l.b)(this,void 0,void 0,(function(){var e;return Object(l.e)(this,(function(n){switch(n.label){case 0:return this.dismissLoader(),e=this,[4,this.loadingController.create({message:t})];case 1:return e.loader=n.sent(),[4,this.loader.present().catch(Object(f.b)(f.a.IONIC_LOADER))];case 2:return n.sent(),[2]}}))}))},t.prototype.dismissLoader=function(){this.loader&&(this.loader.dismiss().catch(Object(f.b)(f.a.IONIC_LOADER)),this.loader=null)},t.\u0275fac=function(e){return new(e||t)(m.Ib(o.g),m.Ib(o.a),m.Ib(p.a),m.Ib(a.a),m.Ib(a.Cb),m.Ib(s.e),m.Ib(g.a))},t.\u0275cmp=m.Cb({type:t,selectors:[["page-ledger-sign"]],decls:20,vars:16,consts:[[1,"ion-no-border"],["fixed","true",1,"ion-no-padding"],["slot","start"],["defaultHref","/"],[1,"ion-padding","ion-margin-bottom"],[3,"innerHTML"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["id","confirm","size","default","color","primary","shape","round",3,"click"],[1,"ion-padding-bottom","ion-text-center"],["size","4",1,"content--align__center-center"],["size","4"],["class","ion-padding-horizontal",3,"transaction",4,"ngFor","ngForOf"],[1,"ion-padding-horizontal",3,"transaction"]],template:function(t,e){1&t&&(m.Nb(0,"ion-header",0),m.Nb(1,"ion-grid",1),m.Nb(2,"ion-toolbar"),m.Nb(3,"ion-buttons",2),m.Jb(4,"ion-back-button",3),m.Mb(),m.Nb(5,"ion-title"),m.uc(6),m.Yb(7,"translate"),m.Yb(8,"uppercase"),m.Mb(),m.Mb(),m.Mb(),m.Mb(),m.Nb(9,"ion-content",4),m.Nb(10,"ion-grid",1),m.Nb(11,"ion-row"),m.Jb(12,"h5",5),m.Yb(13,"translate"),m.Mb(),m.sc(14,N,24,17,"ng-container",6),m.sc(15,I,2,1,"ng-container",6),m.Mb(),m.Nb(16,"ion-fab",7),m.Nb(17,"ion-button",8),m.Vb("click",(function(){return e.signTx()})),m.uc(18),m.Yb(19,"translate"),m.Mb(),m.Mb(),m.Mb()),2&t&&(m.yb(6),m.vc(m.ac(7,5,"ledger-sign.title",m.hc(14,T,m.Zb(8,8,e.wallet.protocol.identifier)))),m.yb(6),m.dc("innerHTML",m.Zb(13,10,"ledger-sign.text"),m.mc),m.yb(2),m.dc("ngIf",e.airGapTxs&&e.airGapTxs.length>1),m.yb(1),m.dc("ngIf",e.airGapTxs),m.yb(3),m.wc(" ",m.Zb(19,12,"ledger-sign.confirm_label")," "))},directives:[a.A,a.z,a.yb,a.k,a.f,a.g,a.wb,a.t,a.fb,i.t,a.v,a.j,a.s,i.s,r.n],pipes:[s.d,i.G,i.b,r.f,r.m],styles:[""]}),t}(),M=function(){function t(){}return t.\u0275mod=m.Gb({type:t}),t.\u0275inj=m.Fb({factory:function(e){return new(e||t)},imports:[[a.Ab,i.c,c.a,s.c,b.a,r.d,o.k.forChild([{path:"",component:x}])]]}),t}()}}]);