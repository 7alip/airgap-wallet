(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{awK3:function(t,e,n){"use strict";n.r(e),n.d(e,"LedgerSignPageModule",function(){return I});var r=n("138U"),i=n("ofXK"),o=n("tyNb"),a=n("TEn/"),s=n("sYmb"),c=n("j1ZV"),b=n("iTUp"),l=n("mrSG"),u=n("RKiA"),d=n("kB5k"),h=n.n(d),p=n("1y+R"),f=n("z26V"),g=n("hPkG"),O=n("fXoL"),m=function(t){return{protocol:t,maxDigits:void 0}},v=function(t){return{protocol:t}};function w(t,e){if(1&t&&(O.Mb(0),O.Ob(1,"ion-row",9),O.Ob(2,"ion-col",10),O.Ob(3,"h5"),O.vc(4),O.Zb(5,"async"),O.Zb(6,"amountConverter"),O.Nb(),O.Nb(),O.Ob(7,"ion-col",10),O.Ob(8,"h5"),O.vc(9),O.Nb(),O.Nb(),O.Ob(10,"ion-col",10),O.Ob(11,"h5"),O.vc(12),O.Zb(13,"async"),O.Zb(14,"feeConverter"),O.Nb(),O.Nb(),O.Ob(15,"ion-col",11),O.Ob(16,"small"),O.vc(17,"Amount"),O.Nb(),O.Nb(),O.Ob(18,"ion-col",11),O.Ob(19,"small"),O.vc(20,"Operations"),O.Nb(),O.Nb(),O.Ob(21,"ion-col",11),O.Ob(22,"small"),O.vc(23,"Fee"),O.Nb(),O.Nb(),O.Nb(),O.Lb()),2&t){var n=O.Yb();O.yb(4),O.xc(" ",O.ac(5,3,O.bc(6,5,n.aggregatedInfo.totalAmount.toFixed(),O.ic(13,m,n.airGapTxs[0].protocolIdentifier)))," "),O.yb(5),O.wc(n.aggregatedInfo.numberOfTxs),O.yb(3),O.wc(O.ac(13,8,O.bc(14,10,n.aggregatedInfo.totalFees.toFixed(),O.ic(15,v,n.airGapTxs[0].protocolIdentifier))))}}function N(t,e){1&t&&O.Kb(0,"airgap-from-to",13),2&t&&O.ec("transaction",e.$implicit)}function T(t,e){if(1&t&&(O.Mb(0),O.tc(1,N,1,1,"airgap-from-to",12),O.Lb()),2&t){var n=O.Yb();O.yb(1),O.ec("ngForOf",n.airGapTxs)}}var y=function(t){return{title:t}},x=function(){function t(t,e,n,r,i,o,a){var s=this;if(this.router=t,this.route=e,this.dataService=n,this.alertCtrl=r,this.loadingController=i,this.translateService=o,this.ledgerService=a,this.wallet=null,this.airGapTxs=null,this.route.snapshot.data.special){var c=this.route.snapshot.data.special;this.wallet=c.wallet,this.airGapTxs=c.airGapTxs,this.unsignedTx=c.data,this.airGapTxs.length>1&&this.airGapTxs.every(function(t){return t.protocolIdentifier===s.airGapTxs[0].protocolIdentifier})&&(this.aggregatedInfo={numberOfTxs:this.airGapTxs.length,totalAmount:this.airGapTxs.map(function(t){return new h.a(t.amount)}).filter(function(t){return!t.isNaN()}).reduce(function(t,e){return t.plus(e)},new h.a(0)),totalFees:this.airGapTxs.reduce(function(t,e){return t.plus(e.fee)},new h.a(0))},console.log("aggregatedInfo",this.aggregatedInfo))}this.connectWithLedger()}return t.prototype.connectWithLedger=function(){return Object(l.b)(this,void 0,void 0,function(){var t;return Object(l.e)(this,function(e){switch(e.label){case 0:return[4,this.showLoader("Connecting device...")];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,5,6]),[4,this.ledgerService.openConnection(this.wallet.protocol.identifier)];case 3:return e.sent(),[3,6];case 4:return t=e.sent(),console.warn(t),this.promptError(t),[3,6];case 5:return this.dismissLoader(),[7];case 6:return[2]}})})},t.prototype.signTx=function(){return Object(l.b)(this,void 0,void 0,function(){var t,e,n;return Object(l.e)(this,function(r){switch(r.label){case 0:return[4,this.showLoader("Signing transaction...")];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,5,6]),[4,this.ledgerService.signTransaction(this.wallet.protocol.identifier,this.unsignedTx)];case 3:return t=r.sent(),e={id:Object(u.generateId)(10),type:u.IACMessageType.MessageSignResponse,protocol:this.wallet.protocol.identifier,payload:{transaction:t,accountIdentifier:this.wallet.publicKey.substr(-6)}},this.dataService.setData(p.b.TRANSACTION,{messageDefinitionObjects:[e]}),this.router.navigateByUrl("/transaction-confirm/"+p.b.TRANSACTION).catch(Object(g.b)(g.a.NAVIGATION)),[3,6];case 4:return n=r.sent(),console.warn(n),this.promptError(n),[3,6];case 5:return this.dismissLoader(),[7];case 6:return[2]}})})},t.prototype.promptError=function(t){return Object(l.b)(this,void 0,void 0,function(){var e;return Object(l.e)(this,function(n){switch(n.label){case 0:if("string"==typeof t){if("Rejected"===t)return[2];e=t}else e=t instanceof Error?t.message:this.translateService.instant("ledger-sign.error-alert.unknown");return[4,this.alertCtrl.create({header:this.translateService.instant("ledger-sign.error-alert.header"),message:e,buttons:[{text:this.translateService.instant("ledger-sign.error-alert.confirm")}]})];case 1:return n.sent().present().catch(Object(g.b)(g.a.IONIC_ALERT)),[2]}})})},t.prototype.showLoader=function(t){return Object(l.b)(this,void 0,void 0,function(){var e;return Object(l.e)(this,function(n){switch(n.label){case 0:return this.dismissLoader(),e=this,[4,this.loadingController.create({message:t})];case 1:return e.loader=n.sent(),[4,this.loader.present().catch(Object(g.b)(g.a.IONIC_LOADER))];case 2:return n.sent(),[2]}})})},t.prototype.dismissLoader=function(){this.loader&&(this.loader.dismiss().catch(Object(g.b)(g.a.IONIC_LOADER)),this.loader=null)},t.\u0275fac=function(e){return new(e||t)(O.Jb(o.g),O.Jb(o.a),O.Jb(p.a),O.Jb(a.a),O.Jb(a.kb),O.Jb(s.d),O.Jb(f.a))},t.\u0275cmp=O.Db({type:t,selectors:[["page-ledger-sign"]],decls:20,vars:16,consts:[[1,"ion-no-border"],["fixed","true",1,"ion-no-padding"],["slot","start"],["defaultHref","/"],[1,"ion-padding","ion-margin-bottom"],[3,"innerHTML"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["id","confirm","size","default","color","primary","shape","round",3,"click"],[1,"ion-padding-bottom","ion-text-center"],["size","4",1,"content--align__center-center"],["size","4"],["class","ion-padding-horizontal",3,"transaction",4,"ngFor","ngForOf"],[1,"ion-padding-horizontal",3,"transaction"]],template:function(t,e){1&t&&(O.Ob(0,"ion-header",0),O.Ob(1,"ion-grid",1),O.Ob(2,"ion-toolbar"),O.Ob(3,"ion-buttons",2),O.Kb(4,"ion-back-button",3),O.Nb(),O.Ob(5,"ion-title"),O.vc(6),O.Zb(7,"translate"),O.Zb(8,"uppercase"),O.Nb(),O.Nb(),O.Nb(),O.Nb(),O.Ob(9,"ion-content",4),O.Ob(10,"ion-grid",1),O.Ob(11,"ion-row"),O.Kb(12,"h5",5),O.Zb(13,"translate"),O.Nb(),O.tc(14,w,24,17,"ng-container",6),O.tc(15,T,2,1,"ng-container",6),O.Nb(),O.Ob(16,"ion-fab",7),O.Ob(17,"ion-button",8),O.Wb("click",function(){return e.signTx()}),O.vc(18),O.Zb(19,"translate"),O.Nb(),O.Nb(),O.Nb()),2&t&&(O.yb(6),O.wc(O.bc(7,5,"ledger-sign.title",O.ic(14,y,O.ac(8,8,e.wallet.protocol.identifier)))),O.yb(6),O.ec("innerHTML",O.ac(13,10,"ledger-sign.text"),O.nc),O.yb(2),O.ec("ngIf",e.airGapTxs&&e.airGapTxs.length>1),O.yb(1),O.ec("ngIf",e.airGapTxs),O.yb(3),O.xc(" ",O.ac(19,12,"ledger-sign.confirm_label")," "))},directives:[a.v,a.u,a.hb,a.j,a.f,a.g,a.fb,a.q,a.R,i.n,a.r,a.i,a.p,i.m,r.n],pipes:[s.c,i.r,i.b,r.f,r.m],styles:[""]}),t}(),I=function(){function t(){}return t.\u0275mod=O.Hb({type:t}),t.\u0275inj=O.Gb({factory:function(e){return new(e||t)},imports:[[a.ib,i.c,c.a,s.b,b.a,r.d,o.j.forChild([{path:"",component:x}])]]}),t}()}}]);