(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{"1ZIO":function(t,e,n){"use strict";n.r(e),n.d(e,"TransactionConfirmPageModule",function(){return w});var o=n("ofXK"),i=n("3Pt+"),c=n("tyNb"),a=n("TEn/"),r=n("sYmb"),s=n("j1ZV"),b=n("mrSG"),l=n("138U"),u=n("RKiA"),h=n("14cC"),d=n("kB5k"),p=n.n(d),f=n("57MG"),O=n("jysE"),g=n("1y+R"),T=n("q3zY"),v=n("GsAe"),I=n("hPkG"),m=n("AFs5"),j=n("fXoL"),A=n("l5qu"),y=function(){function t(t,e,n,o,i,c,a,r,s,b,l,u,h){this.loadingCtrl=t,this.toastCtrl=e,this.router=n,this.route=o,this.alertCtrl=i,this.platform=c,this.storageProvider=a,this.beaconService=r,this.pushBackendProvider=s,this.browserService=b,this.accountService=l,this.protocolService=u,this.dataService=h,this.txInfos=[],this.protocols=[]}return t.prototype.dismiss=function(){this.router.navigateByUrl("/tabs/portfolio").catch(Object(I.b)(I.a.NAVIGATION))},t.prototype.ionViewWillEnter=function(){return Object(b.b)(this,void 0,void 0,function(){var t=this;return Object(b.e)(this,function(e){switch(e.label){case 0:return[4,this.platform.ready()];case 1:return e.sent(),this.route.snapshot.data.special&&(this.messageDefinitionObjects=this.route.snapshot.data.special.messageDefinitionObjects),this.messageDefinitionObjects.forEach(function(e){return Object(b.b)(t,void 0,void 0,function(){var t,n,o,i,c,a;return Object(b.e)(this,function(r){switch(r.label){case 0:return[4,this.protocolService.getProtocol(e.protocol)];case 1:return t=r.sent(),n=this.accountService.walletBySerializerAccountIdentifier(e.payload.accountIdentifier,e.protocol),[4,this.beaconService.getVaultRequest(e.id)];case 2:return o=b.i.apply(void 0,[r.sent(),2]),c=o[1],this.txInfos.push([e.payload.transaction,a=(i=o[0])&&c&&c.identifier===t.identifier?c:n&&n.protocol?n.protocol:t,i]),this.protocols.push(a),[2]}})})}),[2]}})})},t.prototype.broadcastTransaction=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e,n=this;return Object(b.e)(this,function(o){switch(o.label){case 0:return 1!==this.protocols.length||this.protocols[0].identifier!==u.MainProtocolSymbols.XTZ_SHIELDED?[3,2]:[4,this.wrapInTezosOperation(this.protocols[0],this.txInfos[0][0])];case 1:return o.sent(),[2];case 2:return[4,this.loadingCtrl.create({message:"Broadcasting..."})];case 3:return(t=o.sent()).present().catch(Object(I.b)(I.a.NAVIGATION)),e=setTimeout(function(){return Object(b.b)(n,void 0,void 0,function(){return Object(b.e)(this,function(e){switch(e.label){case 0:return t.dismiss().catch(Object(I.b)(I.a.NAVIGATION)),[4,this.toastCtrl.create({duration:3e3,message:"Transaction queued. It might take some time until your TX shows up!",buttons:[{text:"Ok",role:"cancel"}],position:"bottom"})];case 1:return e.sent().present().catch(Object(I.b)(I.a.IONIC_TOAST)),this.router.navigateByUrl("/tabs/portfolio").catch(Object(I.b)(I.a.NAVIGATION)),[2]}})})},2e4),this.txInfos.forEach(function(o,i){var c=Object(b.i)(o,3),a=c[0],r=c[1],s=c[2];return Object(b.b)(n,void 0,void 0,function(){var n=this;return Object(b.e)(this,function(o){return r.broadcastTransaction(a).then(function(o){return Object(b.b)(n,void 0,void 0,function(){var n,c,l;return Object(b.e)(this,function(b){switch(b.label){case 0:return console.log("transaction hash",o),s&&(n={id:s.id,type:this.beaconService.getResponseByRequestType(s.type),transactionHash:o},this.beaconService.respond(n).catch(Object(I.b)(I.a.BEACON))),e&&clearInterval(e),c={protocol:this.messageDefinitionObjects[i].protocol,accountIdentifier:this.messageDefinitionObjects[i].payload.accountIdentifier,date:(new Date).getTime()},this.storageProvider.set(m.a.LAST_TX_BROADCAST,c).catch(Object(I.b)(I.a.STORAGE)),t.dismiss().catch(Object(I.b)(I.a.NAVIGATION)),this.showTransactionSuccessfulAlert(r,o),r.options.network.type!==h.NetworkType.MAINNET?[3,2]:[4,r.getTransactionDetailsFromSigned(this.messageDefinitionObjects[i].payload)];case 1:(l=b.sent()[0]).amount=l.amount.toString(),l.fee=l.fee.toString(),l.signedTx=a,l.hash=o,console.log("SIGNED TX",l),this.pushBackendProvider.postPendingTx(l),b.label=2;case 2:return[2]}})})}).catch(function(o){e&&clearInterval(e),Object(I.b)(I.a.COINLIB)(o),t.dismiss().catch(Object(I.b)(I.a.NAVIGATION)),o&&o.message&&o.message.startsWith("Failed to check for transaction receipt")?r.getTransactionDetailsFromSigned(n.messageDefinitionObjects[i].payload).then(function(t){t.hash?(n.showTransactionSuccessfulAlert(r,t.hash),t.amount=t.amount.toString(),t.fee=t.fee.toString(),t.signedTx=a,n.pushBackendProvider.postPendingTx(t)):Object(I.b)(I.a.COINLIB)("No transaction hash present in signed ETH transaction")}):n.toastCtrl.create({duration:5e3,message:"Transaction broadcasting failed: "+o,buttons:[{text:"Ok",role:"cancel"}],position:"bottom"}).then(function(t){t.present().catch(Object(I.b)(I.a.NAVIGATION))}).catch(Object(I.b)(I.a.IONIC_TOAST)),n.router.navigateByUrl("/tabs/portfolio").catch(Object(I.b)(I.a.NAVIGATION))}),[2]})})}),[2]}})})},t.prototype.showTransactionSuccessfulAlert=function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,o=this;return Object(b.e)(this,function(i){switch(i.label){case 0:return[4,t.getBlockExplorerLinkForTxId(e)];case 1:return n=i.sent(),this.alertCtrl.create({header:"Transaction broadcasted!",message:"Your transaction has been successfully broadcasted",buttons:[{text:"Open Blockexplorer",handler:function(){o.browserService.openUrl(n),o.router.navigateByUrl("/tabs/portfolio").catch(Object(I.b)(I.a.NAVIGATION))}},{text:"Ok",handler:function(){o.router.navigateByUrl("/tabs/portfolio").catch(Object(I.b)(I.a.NAVIGATION))}}]}).then(function(t){t.present().catch(Object(I.b)(I.a.NAVIGATION))}).catch(Object(I.b)(I.a.IONIC_ALERT)),[2]}})})},t.prototype.wrapInTezosOperation=function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,o,i;return Object(b.e)(this,function(c){switch(c.label){case 0:return[4,this.selectTezosTzAccount(t)];case 1:return n=c.sent(),[4,t.wrapSaplingTransactions(n.publicKey,e,new p.a(n.protocol.feeDefaults.medium).shiftedBy(n.protocol.feeDecimals).toString(),!0)];case 2:return o=c.sent(),[4,t.getTransactionDetails({publicKey:n.publicKey,transaction:o},{knownViewingKeys:this.accountService.getKnownViewingKeys()})];case 3:return i=c.sent(),this.dataService.setData(g.b.INTERACTION,{wallet:n,airGapTxs:i,data:o,type:u.IACMessageType.TransactionSignRequest}),this.router.navigateByUrl("/interaction-selection/"+g.b.INTERACTION).catch(Object(I.b)(I.a.NAVIGATION)),[2]}})})},t.prototype.selectTezosTzAccount=function(t){return Object(b.b)(this,void 0,void 0,function(){var e=this;return Object(b.e)(this,function(n){return[2,new Promise(function(n){var o=e.accountService.getWalletList(),i=Object(b.i)(Object(l.J)(o,function(t){return t.protocol.identifier===u.MainProtocolSymbols.XTZ}),2);e.dataService.setData(g.b.WALLET,{actionType:"broadcast",targetIdentifier:t.identifier,compatibleWallets:i[0],incompatibleWallets:i[1],callback:n}),e.router.navigateByUrl("/select-wallet/"+g.b.WALLET).catch(Object(I.b)(I.a.NAVIGATION))})]})})},t.\u0275fac=function(e){return new(e||t)(j.Lb(a.kb),j.Lb(a.vb),j.Lb(c.g),j.Lb(c.a),j.Lb(a.a),j.Lb(a.pb),j.Lb(m.b),j.Lb(T.a),j.Lb(v.a),j.Lb(O.a),j.Lb(f.a),j.Lb(l.y),j.Lb(g.a))},t.\u0275cmp=j.Fb({type:t,selectors:[["page-transaction-confirm"]],decls:23,vars:11,consts:[[1,"ion-no-border"],["fixed","true",1,"ion-no-padding"],["slot","start"],["defaultHref","/"],[1,"ion-padding"],[3,"signedTxs","protocols"],["vertical","bottom","slot","fixed"],["size","default","expand","full","color","secondary","shape","round",3,"click"],["slot","start","name","close"],["size","default","expand","full","color","primary","shape","round",3,"click"],["slot","start","name","checkmark"]],template:function(t,e){1&t&&(j.Qb(0,"ion-header",0),j.Qb(1,"ion-grid",1),j.Qb(2,"ion-toolbar"),j.Qb(3,"ion-buttons",2),j.Mb(4,"ion-back-button",3),j.Pb(),j.Qb(5,"ion-title"),j.wc(6),j.bc(7,"translate"),j.Pb(),j.Pb(),j.Pb(),j.Pb(),j.Qb(8,"ion-content",4),j.Qb(9,"ion-grid",1),j.Mb(10,"signed-transaction",5),j.Pb(),j.Qb(11,"ion-fab",6),j.Qb(12,"ion-row"),j.Qb(13,"ion-col"),j.Qb(14,"ion-button",7),j.Yb("click",function(){return e.dismiss()}),j.Mb(15,"ion-icon",8),j.wc(16),j.bc(17,"translate"),j.Pb(),j.Pb(),j.Qb(18,"ion-col"),j.Qb(19,"ion-button",9),j.Yb("click",function(){return e.broadcastTransaction()}),j.Mb(20,"ion-icon",10),j.wc(21),j.bc(22,"translate"),j.Pb(),j.Pb(),j.Pb(),j.Pb(),j.Pb()),2&t&&(j.Ab(6),j.xc(j.cc(7,5,"transaction-confirm.title")),j.Ab(4),j.gc("signedTxs",e.messageDefinitionObjects)("protocols",e.protocols),j.Ab(6),j.yc(" ",j.cc(17,7,"transaction-confirm.decline_label")," "),j.Ab(5),j.yc(" ",j.cc(22,9,"transaction-confirm.confirm_label")," "))},directives:[a.v,a.u,a.hb,a.j,a.f,a.g,a.fb,a.q,A.a,a.r,a.R,a.p,a.i,a.w],pipes:[r.c],styles:["ion-fab[_ngcontent-%COMP%]{width:100%}"]}),t}(),w=function(){function t(){}return t.\u0275mod=j.Jb({type:t}),t.\u0275inj=j.Ib({factory:function(e){return new(e||t)},imports:[[a.ib,o.c,i.e,r.b,s.a,c.j.forChild([{path:"",component:y}])]]}),t}()}}]);