(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{"1ZIO":function(t,e,n){"use strict";n.r(e),n.d(e,"TransactionConfirmPageModule",function(){return N});var o=n("ofXK"),i=n("3Pt+"),a=n("tyNb"),r=n("TEn/"),c=n("sYmb"),s=n("j1ZV"),b=n("mrSG"),l=n("14cC"),u=n("57MG"),h=n("jysE"),f=n("q3zY"),d=n("GsAe"),p=n("hPkG"),O=n("AFs5"),g=n("fXoL"),m=n("138U"),T=n("l5qu"),v=function(){function TransactionConfirmPage(t,e,n,o,i,a,r,c,s,b,l,u){this.loadingCtrl=t,this.toastCtrl=e,this.router=n,this.route=o,this.alertCtrl=i,this.platform=a,this.storageProvider=r,this.beaconService=c,this.pushBackendProvider=s,this.browserService=b,this.accountService=l,this.protocolService=u,this.txInfos=[],this.protocols=[]}return TransactionConfirmPage.prototype.dismiss=function(){this.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION))},TransactionConfirmPage.prototype.ionViewWillEnter=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e=this;return Object(b.e)(this,function(n){switch(n.label){case 0:return[4,this.platform.ready()];case 1:return n.sent(),this.route.snapshot.data.special&&(t=this.route.snapshot.data.special,this.messageDefinitionObjects=t.messageDefinitionObjects),this.messageDefinitionObjects.forEach(function(t){return Object(b.b)(e,void 0,void 0,function(){var e,n,o,i,a,r;return Object(b.e)(this,function(c){switch(c.label){case 0:return[4,this.protocolService.getProtocol(t.protocol)];case 1:return e=c.sent(),n=this.accountService.walletBySerializerAccountIdentifier(t.payload.accountIdentifier,t.protocol),[4,this.beaconService.getVaultRequest(t.id)];case 2:return o=b.h.apply(void 0,[c.sent(),2]),i=o[0],a=o[1],r=i&&a&&a.identifier===e.identifier?a:n&&n.protocol?n.protocol:e,this.txInfos.push([t.payload.transaction,r,i]),this.protocols.push(r),[2]}})})}),[2]}})})},TransactionConfirmPage.prototype.broadcastTransaction=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e,n=this;return Object(b.e)(this,function(o){switch(o.label){case 0:return[4,this.loadingCtrl.create({message:"Broadcasting..."})];case 1:return(t=o.sent()).present().catch(Object(p.b)(p.a.NAVIGATION)),e=setTimeout(function(){return Object(b.b)(n,void 0,void 0,function(){return Object(b.e)(this,function(e){switch(e.label){case 0:return t.dismiss().catch(Object(p.b)(p.a.NAVIGATION)),[4,this.toastCtrl.create({duration:3e3,message:"Transaction queued. It might take some time until your TX shows up!",buttons:[{text:"Ok",role:"cancel"}],position:"bottom"})];case 1:return e.sent().present().catch(Object(p.b)(p.a.IONIC_TOAST)),this.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION)),[2]}})})},2e4),this.txInfos.forEach(function(o,i){var a=Object(b.h)(o,3),r=a[0],c=a[1],s=a[2];return Object(b.b)(n,void 0,void 0,function(){var n=this;return Object(b.e)(this,function(o){return c.broadcastTransaction(r).then(function(o){return Object(b.b)(n,void 0,void 0,function(){var n,a,u,h;return Object(b.e)(this,function(b){switch(b.label){case 0:return console.log("transaction hash",o),s&&(n={id:s.id,type:this.beaconService.getResponseByRequestType(s.type),transactionHash:o},this.beaconService.respond(n).catch(Object(p.b)(p.a.BEACON))),e&&clearInterval(e),a=this.messageDefinitionObjects[i].payload,u={protocol:this.messageDefinitionObjects[i].protocol,accountIdentifier:a.accountIdentifier,date:(new Date).getTime()},this.storageProvider.set(O.a.LAST_TX_BROADCAST,u).catch(Object(p.b)(p.a.STORAGE)),t.dismiss().catch(Object(p.b)(p.a.NAVIGATION)),this.showTransactionSuccessfulAlert(c,o),c.options.network.type!==l.NetworkType.MAINNET?[3,2]:[4,c.getTransactionDetailsFromSigned(this.messageDefinitionObjects[i].payload)];case 1:(h=b.sent()[0]).amount=h.amount.toString(),h.fee=h.fee.toString(),h.signedTx=r,h.hash=o,console.log("SIGNED TX",h),this.pushBackendProvider.postPendingTx(h),b.label=2;case 2:return[2]}})})}).catch(function(o){e&&clearInterval(e),Object(p.b)(p.a.COINLIB)(o),t.dismiss().catch(Object(p.b)(p.a.NAVIGATION)),o&&o.message&&o.message.startsWith("Failed to check for transaction receipt")?c.getTransactionDetailsFromSigned(n.messageDefinitionObjects[i].payload).then(function(t){t.hash?(n.showTransactionSuccessfulAlert(c,t.hash),t.amount=t.amount.toString(),t.fee=t.fee.toString(),t.signedTx=r,n.pushBackendProvider.postPendingTx(t)):Object(p.b)(p.a.COINLIB)("No transaction hash present in signed ETH transaction")}):n.toastCtrl.create({duration:5e3,message:"Transaction broadcasting failed: "+o,buttons:[{text:"Ok",role:"cancel"}],position:"bottom"}).then(function(t){t.present().catch(Object(p.b)(p.a.NAVIGATION))}).catch(Object(p.b)(p.a.IONIC_TOAST)),n.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION))}),[2]})})}),[2]}})})},TransactionConfirmPage.prototype.showTransactionSuccessfulAlert=function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,o=this;return Object(b.e)(this,function(i){switch(i.label){case 0:return[4,t.getBlockExplorerLinkForTxId(e)];case 1:return n=i.sent(),this.alertCtrl.create({header:"Transaction broadcasted!",message:"Your transaction has been successfully broadcasted",buttons:[{text:"Open Blockexplorer",handler:function(){o.browserService.openUrl(n),o.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION))}},{text:"Ok",handler:function(){o.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION))}}]}).then(function(t){t.present().catch(Object(p.b)(p.a.NAVIGATION))}).catch(Object(p.b)(p.a.IONIC_ALERT)),[2]}})})},TransactionConfirmPage.\u0275fac=function TransactionConfirmPage_Factory(t){return new(t||TransactionConfirmPage)(g.Jb(r.kb),g.Jb(r.vb),g.Jb(a.g),g.Jb(a.a),g.Jb(r.a),g.Jb(r.pb),g.Jb(O.b),g.Jb(f.a),g.Jb(d.a),g.Jb(h.a),g.Jb(u.a),g.Jb(m.x))},TransactionConfirmPage.\u0275cmp=g.Db({type:TransactionConfirmPage,selectors:[["page-transaction-confirm"]],decls:23,vars:11,consts:[[1,"ion-no-border"],["fixed","true",1,"ion-no-padding"],["slot","start"],["defaultHref","/"],[1,"ion-padding"],[3,"signedTxs","protocols"],["vertical","bottom","slot","fixed"],["size","default","expand","full","color","secondary","shape","round",3,"click"],["slot","start","name","close"],["size","default","expand","full","color","primary","shape","round",3,"click"],["slot","start","name","checkmark"]],template:function TransactionConfirmPage_Template(t,e){1&t&&(g.Ob(0,"ion-header",0),g.Ob(1,"ion-grid",1),g.Ob(2,"ion-toolbar"),g.Ob(3,"ion-buttons",2),g.Kb(4,"ion-back-button",3),g.Nb(),g.Ob(5,"ion-title"),g.vc(6),g.Zb(7,"translate"),g.Nb(),g.Nb(),g.Nb(),g.Nb(),g.Ob(8,"ion-content",4),g.Ob(9,"ion-grid",1),g.Kb(10,"signed-transaction",5),g.Nb(),g.Ob(11,"ion-fab",6),g.Ob(12,"ion-row"),g.Ob(13,"ion-col"),g.Ob(14,"ion-button",7),g.Wb("click",function TransactionConfirmPage_Template_ion_button_click_14_listener(){return e.dismiss()}),g.Kb(15,"ion-icon",8),g.vc(16),g.Zb(17,"translate"),g.Nb(),g.Nb(),g.Ob(18,"ion-col"),g.Ob(19,"ion-button",9),g.Wb("click",function TransactionConfirmPage_Template_ion_button_click_19_listener(){return e.broadcastTransaction()}),g.Kb(20,"ion-icon",10),g.vc(21),g.Zb(22,"translate"),g.Nb(),g.Nb(),g.Nb(),g.Nb(),g.Nb()),2&t&&(g.yb(6),g.wc(g.ac(7,5,"transaction-confirm.title")),g.yb(4),g.ec("signedTxs",e.messageDefinitionObjects)("protocols",e.protocols),g.yb(6),g.xc(" ",g.ac(17,7,"transaction-confirm.decline_label")," "),g.yb(5),g.xc(" ",g.ac(22,9,"transaction-confirm.confirm_label")," "))},directives:[r.v,r.u,r.hb,r.j,r.f,r.g,r.fb,r.q,T.a,r.r,r.R,r.p,r.i,r.w],pipes:[c.c],styles:["ion-fab[_ngcontent-%COMP%]{width:100%}"]}),TransactionConfirmPage}(),N=function(){function TransactionConfirmPageModule(){}return TransactionConfirmPageModule.\u0275mod=g.Hb({type:TransactionConfirmPageModule}),TransactionConfirmPageModule.\u0275inj=g.Gb({factory:function TransactionConfirmPageModule_Factory(t){return new(t||TransactionConfirmPageModule)},imports:[[r.ib,o.c,i.e,c.b,s.a,a.j.forChild([{path:"",component:v}])]]}),TransactionConfirmPageModule}()}}]);