(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{"1ZIO":function(t,e,n){"use strict";n.r(e),n.d(e,"TransactionConfirmPageModule",function(){return N});var o=n("ofXK"),i=n("3Pt+"),a=n("tyNb"),c=n("TEn/"),s=n("sYmb"),r=n("j1ZV"),b=n("mrSG"),u=n("14cC"),l=n("57MG"),h=n("jysE"),d=n("q3zY"),f=n("GsAe"),p=n("hPkG"),O=n("AFs5"),g=n("fXoL"),v=n("138U"),m=n("l5qu"),T=function(){function t(t,e,n,o,i,a,c,s,r,b,u,l){this.loadingCtrl=t,this.toastCtrl=e,this.router=n,this.route=o,this.alertCtrl=i,this.platform=a,this.storageProvider=c,this.beaconService=s,this.pushBackendProvider=r,this.browserService=b,this.accountService=u,this.protocolService=l,this.txInfos=[],this.protocols=[]}return t.prototype.dismiss=function(){this.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION))},t.prototype.ionViewWillEnter=function(){return Object(b.b)(this,void 0,void 0,function(){var t=this;return Object(b.e)(this,function(e){switch(e.label){case 0:return[4,this.platform.ready()];case 1:return e.sent(),this.route.snapshot.data.special&&(this.messageDefinitionObjects=this.route.snapshot.data.special.messageDefinitionObjects),this.messageDefinitionObjects.forEach(function(e){return Object(b.b)(t,void 0,void 0,function(){var t,n,o,i,a,c;return Object(b.e)(this,function(s){switch(s.label){case 0:return[4,this.protocolService.getProtocol(e.protocol)];case 1:return t=s.sent(),n=this.accountService.walletBySerializerAccountIdentifier(e.payload.accountIdentifier,e.protocol),[4,this.beaconService.getVaultRequest(e.id)];case 2:return o=b.h.apply(void 0,[s.sent(),2]),a=o[1],this.txInfos.push([e.payload.transaction,c=(i=o[0])&&a&&a.identifier===t.identifier?a:n&&n.protocol?n.protocol:t,i]),this.protocols.push(c),[2]}})})}),[2]}})})},t.prototype.broadcastTransaction=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e,n=this;return Object(b.e)(this,function(o){switch(o.label){case 0:return[4,this.loadingCtrl.create({message:"Broadcasting..."})];case 1:return(t=o.sent()).present().catch(Object(p.b)(p.a.NAVIGATION)),e=setTimeout(function(){return Object(b.b)(n,void 0,void 0,function(){return Object(b.e)(this,function(e){switch(e.label){case 0:return t.dismiss().catch(Object(p.b)(p.a.NAVIGATION)),[4,this.toastCtrl.create({duration:3e3,message:"Transaction queued. It might take some time until your TX shows up!",buttons:[{text:"Ok",role:"cancel"}],position:"bottom"})];case 1:return e.sent().present().catch(Object(p.b)(p.a.IONIC_TOAST)),this.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION)),[2]}})})},2e4),this.txInfos.forEach(function(o,i){var a=Object(b.h)(o,3),c=a[0],s=a[1],r=a[2];return Object(b.b)(n,void 0,void 0,function(){var n=this;return Object(b.e)(this,function(o){return s.broadcastTransaction(c).then(function(o){return Object(b.b)(n,void 0,void 0,function(){var n,a,l;return Object(b.e)(this,function(b){switch(b.label){case 0:return console.log("transaction hash",o),r&&(n={id:r.id,type:this.beaconService.getResponseByRequestType(r.type),transactionHash:o},this.beaconService.respond(n).catch(Object(p.b)(p.a.BEACON))),e&&clearInterval(e),a={protocol:this.messageDefinitionObjects[i].protocol,accountIdentifier:this.messageDefinitionObjects[i].payload.accountIdentifier,date:(new Date).getTime()},this.storageProvider.set(O.a.LAST_TX_BROADCAST,a).catch(Object(p.b)(p.a.STORAGE)),t.dismiss().catch(Object(p.b)(p.a.NAVIGATION)),this.showTransactionSuccessfulAlert(s,o),s.options.network.type!==u.NetworkType.MAINNET?[3,2]:[4,s.getTransactionDetailsFromSigned(this.messageDefinitionObjects[i].payload)];case 1:(l=b.sent()[0]).amount=l.amount.toString(),l.fee=l.fee.toString(),l.signedTx=c,l.hash=o,console.log("SIGNED TX",l),this.pushBackendProvider.postPendingTx(l),b.label=2;case 2:return[2]}})})}).catch(function(o){e&&clearInterval(e),Object(p.b)(p.a.COINLIB)(o),t.dismiss().catch(Object(p.b)(p.a.NAVIGATION)),o&&o.message&&o.message.startsWith("Failed to check for transaction receipt")?s.getTransactionDetailsFromSigned(n.messageDefinitionObjects[i].payload).then(function(t){t.hash?(n.showTransactionSuccessfulAlert(s,t.hash),t.amount=t.amount.toString(),t.fee=t.fee.toString(),t.signedTx=c,n.pushBackendProvider.postPendingTx(t)):Object(p.b)(p.a.COINLIB)("No transaction hash present in signed ETH transaction")}):n.toastCtrl.create({duration:5e3,message:"Transaction broadcasting failed: "+o,buttons:[{text:"Ok",role:"cancel"}],position:"bottom"}).then(function(t){t.present().catch(Object(p.b)(p.a.NAVIGATION))}).catch(Object(p.b)(p.a.IONIC_TOAST)),n.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION))}),[2]})})}),[2]}})})},t.prototype.showTransactionSuccessfulAlert=function(t,e){return Object(b.b)(this,void 0,void 0,function(){var n,o=this;return Object(b.e)(this,function(i){switch(i.label){case 0:return[4,t.getBlockExplorerLinkForTxId(e)];case 1:return n=i.sent(),this.alertCtrl.create({header:"Transaction broadcasted!",message:"Your transaction has been successfully broadcasted",buttons:[{text:"Open Blockexplorer",handler:function(){o.browserService.openUrl(n),o.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION))}},{text:"Ok",handler:function(){o.router.navigateByUrl("/tabs/portfolio").catch(Object(p.b)(p.a.NAVIGATION))}}]}).then(function(t){t.present().catch(Object(p.b)(p.a.NAVIGATION))}).catch(Object(p.b)(p.a.IONIC_ALERT)),[2]}})})},t.\u0275fac=function(e){return new(e||t)(g.Jb(c.kb),g.Jb(c.vb),g.Jb(a.g),g.Jb(a.a),g.Jb(c.a),g.Jb(c.pb),g.Jb(O.b),g.Jb(d.a),g.Jb(f.a),g.Jb(h.a),g.Jb(l.a),g.Jb(v.x))},t.\u0275cmp=g.Db({type:t,selectors:[["page-transaction-confirm"]],decls:23,vars:11,consts:[[1,"ion-no-border"],["fixed","true",1,"ion-no-padding"],["slot","start"],["defaultHref","/"],[1,"ion-padding"],[3,"signedTxs","protocols"],["vertical","bottom","slot","fixed"],["size","default","expand","full","color","secondary","shape","round",3,"click"],["slot","start","name","close"],["size","default","expand","full","color","primary","shape","round",3,"click"],["slot","start","name","checkmark"]],template:function(t,e){1&t&&(g.Ob(0,"ion-header",0),g.Ob(1,"ion-grid",1),g.Ob(2,"ion-toolbar"),g.Ob(3,"ion-buttons",2),g.Kb(4,"ion-back-button",3),g.Nb(),g.Ob(5,"ion-title"),g.vc(6),g.Zb(7,"translate"),g.Nb(),g.Nb(),g.Nb(),g.Nb(),g.Ob(8,"ion-content",4),g.Ob(9,"ion-grid",1),g.Kb(10,"signed-transaction",5),g.Nb(),g.Ob(11,"ion-fab",6),g.Ob(12,"ion-row"),g.Ob(13,"ion-col"),g.Ob(14,"ion-button",7),g.Wb("click",function(){return e.dismiss()}),g.Kb(15,"ion-icon",8),g.vc(16),g.Zb(17,"translate"),g.Nb(),g.Nb(),g.Ob(18,"ion-col"),g.Ob(19,"ion-button",9),g.Wb("click",function(){return e.broadcastTransaction()}),g.Kb(20,"ion-icon",10),g.vc(21),g.Zb(22,"translate"),g.Nb(),g.Nb(),g.Nb(),g.Nb(),g.Nb()),2&t&&(g.yb(6),g.wc(g.ac(7,5,"transaction-confirm.title")),g.yb(4),g.ec("signedTxs",e.messageDefinitionObjects)("protocols",e.protocols),g.yb(6),g.xc(" ",g.ac(17,7,"transaction-confirm.decline_label")," "),g.yb(5),g.xc(" ",g.ac(22,9,"transaction-confirm.confirm_label")," "))},directives:[c.v,c.u,c.hb,c.j,c.f,c.g,c.fb,c.q,m.a,c.r,c.R,c.p,c.i,c.w],pipes:[s.c],styles:["ion-fab[_ngcontent-%COMP%]{width:100%}"]}),t}(),N=function(){function t(){}return t.\u0275mod=g.Hb({type:t}),t.\u0275inj=g.Gb({factory:function(e){return new(e||t)},imports:[[c.ib,o.c,i.e,s.b,r.a,a.j.forChild([{path:"",component:T}])]]}),t}()}}]);