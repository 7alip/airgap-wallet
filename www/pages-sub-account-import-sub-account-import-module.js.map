{"version":3,"sources":["./src/app/pages/sub-account-import/sub-account-import.ts","./src/app/pages/sub-account-import/sub-account-import.html","./src/app/pages/sub-account-import/sub-account-import.module.ts"],"names":[],"mappings":"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","file":"pages-sub-account-import-sub-account-import-module.js","sourcesContent":["import { ProtocolService, getMainIdentifier } from '@airgap/angular-core'\nimport { Component } from '@angular/core'\nimport { ActivatedRoute, Router } from '@angular/router'\nimport { AirGapMarketWallet, AirGapWalletStatus, ICoinProtocol, NetworkType, ProtocolSymbols } from '@airgap/coinlib-core'\nimport { map } from 'rxjs/operators'\nimport { DataService, DataServiceKey } from 'src/app/services/data/data.service'\nimport { PriceService } from 'src/app/services/price/price.service'\n\nimport { AccountProvider } from '../../services/account/account.provider'\nimport { ErrorCategory, handleErrorSentry } from '../../services/sentry-error-handler/sentry-error-handler'\nimport { AirGapMarketWalletGroup } from 'src/app/models/AirGapMarketWalletGroup'\n\n@Component({\n  selector: 'page-sub-account-import',\n  templateUrl: 'sub-account-import.html'\n})\nexport class SubAccountImportPage {\n  private readonly subProtocolIdentifier: ProtocolSymbols\n  private readonly networkIdentifier: string\n\n  public subProtocol: ICoinProtocol\n  public subWalletsWithGroups: [AirGapMarketWalletGroup | undefined, AirGapMarketWallet][]\n\n  public typeLabel: string = ''\n\n  constructor(\n    private readonly router: Router,\n    private readonly route: ActivatedRoute,\n    private readonly accountProvider: AccountProvider,\n    private readonly priceService: PriceService,\n    private readonly protocolService: ProtocolService,\n    dataService: DataService\n  ) {\n    this.subWalletsWithGroups = []\n    let info: any\n\n    info = dataService.getData(DataServiceKey.PROTOCOL)\n\n    if (info !== undefined) {\n      this.subProtocolIdentifier = info.subProtocolIdentifier\n      this.networkIdentifier = info.networkIdentifier\n      this.protocolService.getProtocol(this.subProtocolIdentifier, this.networkIdentifier).then((protocol: ICoinProtocol) => {\n        this.subProtocol = protocol\n      })\n    } else {\n      this.subProtocolIdentifier = this.route.snapshot.params.protocolID\n      this.networkIdentifier = this.route.snapshot.params.networkID\n\n      this.protocolService.getProtocol(this.subProtocolIdentifier, this.networkIdentifier).then((protocol: ICoinProtocol) => {\n        this.subProtocol = protocol\n      })\n    }\n\n    this.accountProvider.wallets$\n      .pipe(\n        map((mainAccounts) =>\n          mainAccounts.filter(\n            (wallet) =>\n              wallet.status === AirGapWalletStatus.ACTIVE &&\n              wallet.protocol.identifier === getMainIdentifier(this.subProtocolIdentifier) &&\n              wallet.protocol.options.network.type === NetworkType.MAINNET\n          )\n        )\n      )\n      .subscribe((mainAccounts) => {\n        const promises: Promise<void>[] = mainAccounts.map(async (mainAccount) => {\n          const wallet = this.accountProvider.walletByPublicKeyAndProtocolAndAddressIndex(mainAccount.publicKey, this.subProtocolIdentifier)\n          if (!wallet || wallet.status !== AirGapWalletStatus.ACTIVE) {\n            const protocol = await this.protocolService.getProtocol(this.subProtocolIdentifier, this.networkIdentifier)\n            const walletGroup: AirGapMarketWalletGroup = this.accountProvider.findWalletGroup(mainAccount)\n            const airGapMarketWallet: AirGapMarketWallet = new AirGapMarketWallet(\n              protocol,\n              mainAccount.publicKey,\n              mainAccount.isExtendedPublicKey,\n              mainAccount.derivationPath,\n              mainAccount.masterFingerprint,\n              mainAccount.status,\n              this.priceService\n            )\n            airGapMarketWallet.addresses = mainAccount.addresses\n            this.subWalletsWithGroups.push([walletGroup, airGapMarketWallet])\n\n            return airGapMarketWallet.synchronize()\n          }\n        })\n\n        Promise.all(promises)\n          .then(() => this.accountProvider.triggerWalletChanged())\n          .catch(handleErrorSentry(ErrorCategory.COINLIB))\n      })\n  }\n  public importWallets() {\n    const walletAddInfos = this.subWalletsWithGroups.map(([group, subWallet]) => {\n      return {\n        walletToAdd: subWallet,\n        groupId: group !== undefined ? group.id : undefined,\n        groupLabel: group !== undefined ? group.label : undefined\n      }\n    })\n    this.accountProvider.addWallets(walletAddInfos).catch(handleErrorSentry(ErrorCategory.WALLET_PROVIDER))\n    this.popToRoot()\n  }\n\n  public importWallet(group: AirGapMarketWalletGroup | undefined, subWallet: AirGapMarketWallet) {\n    const walletAddInfos = [\n      {\n        walletToAdd: subWallet,\n        groupId: group !== undefined ? group.id : undefined,\n        groupLabel: group !== undefined ? group.label : undefined\n      }\n    ]\n    this.accountProvider.addWallets(walletAddInfos).catch(handleErrorSentry(ErrorCategory.WALLET_PROVIDER))\n    this.popToRoot()\n  }\n\n  public popToRoot() {\n    this.router.navigateByUrl('/tabs/portfolio').catch(handleErrorSentry(ErrorCategory.NAVIGATION))\n  }\n}\n","<ion-header class=\"ion-no-border\">\n  <ion-grid fixed=\"true\" class=\"ion-no-padding\">\n    <ion-toolbar>\n      <ion-buttons slot=\"start\">\n        <ion-back-button defaultHref=\"/\"></ion-back-button>\n      </ion-buttons>\n      <ion-title>{{ 'sub-account-import.title' | translate }}</ion-title>\n    </ion-toolbar>\n  </ion-grid>\n</ion-header>\n\n<ion-content>\n  <ion-grid fixed=\"true\" *ngIf=\"subProtocol\" class=\"ion-no-padding\">\n    <p [innerHTML]=\"'sub-account-import.text' | translate: { subProtocolName: subProtocol.name }\" class=\"ion-padding-horizontal\"></p>\n    <ion-list lines=\"none\" class=\"ion-margin-top\" *ngFor=\"let walletWithGroup of subWalletsWithGroups\">\n      <portfolio-item\n        [wallet]=\"walletWithGroup[1]\"\n        tappable\n        (click)=\"importWallet(walletWithGroup[0], walletWithGroup[1])\"\n      ></portfolio-item>\n    </ion-list>\n    <empty-state\n      *ngIf=\"subWalletsWithGroups.length === 0\"\n      [text]=\"'sub-account-import.empty_text' | translate: { tokenName: subProtocol.name }\"\n      [imageName]=\"'no-imports.svg'\"\n    ></empty-state>\n    <ion-fab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\">\n      <ion-button shape=\"round\" (click)=\"importWallets()\" color=\"secondary\" [disabled]=\"subWalletsWithGroups.length === 0\">\n        <ion-icon slot=\"start\" name=\"add\"></ion-icon>\n        {{ 'sub-account-import.import-all_label' | translate: { typeLabel: typeLabel | translate } }}\n      </ion-button>\n    </ion-fab>\n  </ion-grid>\n</ion-content>\n","import { CommonModule } from '@angular/common'\nimport { NgModule } from '@angular/core'\nimport { FormsModule } from '@angular/forms'\nimport { RouterModule } from '@angular/router'\nimport { IonicModule } from '@ionic/angular'\nimport { TranslateModule } from '@ngx-translate/core'\n\nimport { ComponentsModule } from '../../components/components.module'\n\nimport { SubAccountImportPage } from './sub-account-import'\n\n@NgModule({\n  imports: [\n    IonicModule,\n    CommonModule,\n    FormsModule,\n    ComponentsModule,\n    TranslateModule,\n    RouterModule.forChild([{ path: '', component: SubAccountImportPage }])\n  ],\n  declarations: [SubAccountImportPage]\n})\nexport class SubAccountImportPageModule {}\n"],"sourceRoot":"webpack:///"}