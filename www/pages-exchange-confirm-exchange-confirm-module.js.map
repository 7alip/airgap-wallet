{"version":3,"sources":["./src/app/pages/exchange-confirm/exchange-confirm.module.ts","./src/app/pages/exchange-confirm/exchange-confirm.ts","./src/app/pages/exchange-confirm/exchange-confirm.html"],"names":[],"mappings":"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","file":"pages-exchange-confirm-exchange-confirm-module.js","sourcesContent":["import { AirGapAngularCoreModule } from '@airgap/angular-core'\nimport { CommonModule } from '@angular/common'\nimport { NgModule } from '@angular/core'\nimport { FormsModule } from '@angular/forms'\nimport { RouterModule } from '@angular/router'\nimport { IonicModule } from '@ionic/angular'\nimport { TranslateModule } from '@ngx-translate/core'\n\nimport { ComponentsModule } from '../../components/components.module'\n\nimport { ExchangeConfirmPage } from './exchange-confirm'\n\n@NgModule({\n  imports: [\n    IonicModule,\n    CommonModule,\n    FormsModule,\n    ComponentsModule,\n    TranslateModule,\n    RouterModule.forChild([{ path: '', component: ExchangeConfirmPage }]),\n    AirGapAngularCoreModule\n  ],\n  declarations: [ExchangeConfirmPage]\n})\nexport class ExchangeConfirmPageModule {}\n","import { AirGapMarketWallet, IACMessageType, IAirGapTransaction, UnsignedTransaction } from '@airgap/coinlib-core'\nimport { Component } from '@angular/core'\nimport { ActivatedRoute } from '@angular/router'\nimport BigNumber from 'bignumber.js'\nimport { AccountProvider } from '../../services/account/account.provider'\nimport { BrowserService } from '../../services/browser/browser.service'\nimport { DataService, DataServiceKey } from '../../services/data/data.service'\nimport { ExchangeProvider } from '../../services/exchange/exchange'\nimport { OperationsProvider } from '../../services/operations/operations'\n\n@Component({\n  selector: 'page-exchange-confirm',\n  templateUrl: 'exchange-confirm.html',\n  styleUrls: ['./exchange-confirm.scss']\n})\nexport class ExchangeConfirmPage {\n  public activeExchange: string\n\n  public fromWallet: AirGapMarketWallet\n  public toWallet: AirGapMarketWallet\n\n  public payoutAddress: string\n  public payinAddress: string\n\n  public fee: string\n  public memo?: string\n  public feeFiatAmount: string\n\n  public amountExpectedFrom: number\n  public amountExpectedTo: number\n\n  public fromCurrency: string\n  public toCurrency: string\n\n  public fromFiatAmount: number\n  public toFiatAmount: number\n\n  public airGapTxs?: IAirGapTransaction[]\n  public unsignedTransaction?: UnsignedTransaction\n\n  constructor(\n    private readonly exchangeProvider: ExchangeProvider,\n    private readonly route: ActivatedRoute,\n    private readonly operationsProvider: OperationsProvider,\n    private readonly dataService: DataService,\n    private readonly browserService: BrowserService,\n    private readonly accountProvider: AccountProvider\n  ) {\n    if (this.route.snapshot.data.special) {\n      const info = this.route.snapshot.data.special\n      this.fromWallet = info.fromWallet\n      this.toWallet = info.toWallet\n      this.fromCurrency = info.fromCurrency\n      this.toCurrency = info.toCurrency\n      this.payoutAddress = info.payoutAddress\n      this.payinAddress = info.payinAddress\n      this.fee = info.fee\n      this.memo = info.memo\n      this.airGapTxs = info.transaction?.details\n      this.unsignedTransaction = info.transaction?.unsigned\n\n      this.amountExpectedFrom = info.amountExpectedFrom\n      this.amountExpectedTo = info.amountExpectedTo\n\n      this.feeFiatAmount = new BigNumber(this.fee).multipliedBy(this.fromWallet.currentMarketPrice).toString()\n      this.fromFiatAmount = new BigNumber(this.amountExpectedFrom).multipliedBy(this.fromWallet.currentMarketPrice).toNumber()\n      this.toFiatAmount = new BigNumber(this.amountExpectedTo).multipliedBy(this.toWallet.currentMarketPrice).toNumber()\n    }\n\n    this.exchangeProvider.getActiveExchange().subscribe((exchange) => {\n      this.activeExchange = exchange\n    })\n  }\n\n  public async prepareTransaction() {\n    try {\n      const info = this.unsignedTransaction\n        ? await this.getInteractionInfoFromUnsignedTransaction()\n        : await this.prepareTransactionAndGetInteractionInfo()\n\n      this.dataService.setData(DataServiceKey.INTERACTION, info)\n\n      this.accountProvider.startInteraction(info.wallet, info.data, info.type, info.airGapTxs)\n    } catch (error) {\n      //\n    }\n  }\n\n  private async getInteractionInfoFromUnsignedTransaction(): Promise<any> {\n    const wallet: AirGapMarketWallet = this.fromWallet\n    const airGapTxs: IAirGapTransaction[] = this.airGapTxs ?? (await wallet.protocol.getTransactionDetails(this.unsignedTransaction))\n\n    return {\n      wallet,\n      airGapTxs,\n      data: this.unsignedTransaction.transaction,\n      type: IACMessageType.TransactionSignRequest\n    }\n  }\n\n  private async prepareTransactionAndGetInteractionInfo(): Promise<any> {\n    const wallet = this.fromWallet\n    const amount = new BigNumber(new BigNumber(this.amountExpectedFrom)).shiftedBy(wallet.protocol.decimals)\n    const fee = new BigNumber(this.fee).shiftedBy(wallet.protocol.feeDecimals)\n\n    const { airGapTxs, unsignedTx } = await this.operationsProvider.prepareTransaction(\n      wallet,\n      this.payinAddress,\n      amount,\n      fee,\n      this.accountProvider.getWalletList(),\n      this.memo\n    )\n\n    return {\n      wallet,\n      airGapTxs,\n      data: unsignedTx,\n      type: IACMessageType.TransactionSignRequest\n    }\n  }\n\n  public changellyUrl() {\n    this.browserService.openUrl('https://old.changelly.com/aml-kyc')\n  }\n\n  public changeNowUrl() {\n    this.browserService.openUrl('https://support.changenow.io/hc/en-us/articles/360011609979')\n  }\n}\n","<ion-header class=\"ion-no-border\">\n  <ion-grid fixed=\"true\" class=\"ion-no-padding\">\n    <ion-toolbar>\n      <ion-buttons slot=\"start\">\n        <ion-back-button defaultHref=\"/\"></ion-back-button>\n      </ion-buttons>\n      <ion-title>{{ 'exchange-confirm.title' | translate }}</ion-title>\n    </ion-toolbar>\n  </ion-grid>\n</ion-header>\n\n<ion-content class=\"ion-padding-end\">\n  <ion-grid fixed=\"true\" class=\"ion-no-padding\">\n    <h3 class=\"ion-padding-start ion-padding-bottom\" [innerHTML]=\"'exchange-confirm.heading' | translate\"></h3>\n    <airgap-titled-address\n      [address]=\"fromWallet.receivingPublicAddress\"\n      [title]=\"'exchange-confirm.sell_label'\"\n      [hasSymbol]=\"true\"\n      [symbol]=\"fromCurrency\"\n    ></airgap-titled-address>\n\n    <ion-row class=\"ion-align-items-center ion-padding-vertical\">\n      <ion-col size=\"3\" class=\"ion-no-padding\">\n        <ion-row class=\"ion-justify-content-center\"><div class=\"line--first\"></div></ion-row>\n      </ion-col>\n      <ion-col size=\"9\" class=\"ion-padding-bottom\">\n        <ion-label position=\"stacked\" class=\"ion-text-uppercase\">{{ 'exchange-confirm.sell-amount_label' | translate }}</ion-label>\n        <div class=\"typography--mono\" item-content>\n          <span class=\"typography--mono\">{{ amountExpectedFrom }} (~${{ fromFiatAmount | number: '1.2-2' }})</span>\n        </div>\n\n        <ng-container>\n          <ion-label position=\"stacked\" class=\"ion-text-uppercase\">{{ 'exchange-confirm.fee_label' | translate }}</ion-label>\n          <div class=\"typography--mono\" item-content>\n            <span class=\"typography--mono\">{{ fee }} (~${{ feeFiatAmount | number: '1.2-2' }})</span>\n          </div>\n        </ng-container>\n      </ion-col>\n    </ion-row>\n\n    <airgap-titled-address\n      [address]=\"payinAddress\"\n      [title]=\"'exchange-confirm.exchange-address_label'\"\n      [hasSymbol]=\"true\"\n      [symbol]=\"fromCurrency\"\n    ></airgap-titled-address>\n\n    <ion-row class=\"ion-align-items-center ion-padding-vertical\">\n      <ion-col size=\"3\" class=\"ion-no-padding\">\n        <ion-row class=\"ion-justify-content-center\"><div class=\"line--second\"></div></ion-row>\n      </ion-col>\n      <ion-col size=\"9\" class=\"ion-padding-bottom\">\n        <ion-label position=\"stacked\" class=\"ion-text-uppercase\">{{ 'exchange-confirm.buy-amount_label' | translate }}</ion-label>\n        <div class=\"typography--mono\" item-content>\n          <span class=\"typography--mono\">{{ amountExpectedTo }} (~${{ toFiatAmount | number: '1.2-2' }})</span>\n        </div>\n      </ion-col>\n    </ion-row>\n\n    <airgap-titled-address\n      [address]=\"toWallet.receivingPublicAddress\"\n      [title]=\"'exchange-confirm.receiving-to_label'\"\n      [hasSymbol]=\"true\"\n      [symbol]=\"toCurrency\"\n    ></airgap-titled-address>\n\n    <ion-row *ngIf=\"activeExchange === 'Changelly'\" class=\"ion-padding ion-margin-vertical\" (click)=\"changellyUrl()\">\n      <small [innerHTML]=\"'exchange-confirm.changelly_disclaimer' | translate\"></small>\n    </ion-row>\n\n    <ion-row *ngIf=\"activeExchange === 'ChangeNow'\" class=\"ion-padding ion-margin-vertical\" (click)=\"changeNowUrl()\">\n      <small [innerHTML]=\"'exchange-confirm.changenow_disclaimer' | translate\"></small>\n    </ion-row>\n  </ion-grid>\n  <ion-fab vertical=\"bottom\" horizontal=\"end\" slot=\"fixed\">\n    <ion-button color=\"primary\" shape=\"round\" (click)=\"prepareTransaction()\">\n      {{ 'exchange-confirm.confirm-exchange_label' | translate }}\n    </ion-button>\n  </ion-fab>\n</ion-content>\n"],"sourceRoot":"webpack:///"}