{"version":3,"sources":["./src/app/pages/health-check/health-check-routing.module.ts","./src/app/pages/health-check/health-check.module.ts","./src/app/pages/health-check/health-check.page.ts","./src/app/pages/health-check/health-check.page.html"],"names":[],"mappings":"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","file":"pages-health-check-health-check-module.js","sourcesContent":["import { NgModule } from '@angular/core'\nimport { Routes, RouterModule } from '@angular/router'\n\nimport { HealthCheckPage } from './health-check.page'\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: HealthCheckPage\n  }\n]\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class HealthCheckPageRoutingModule {}\n","import { NgModule } from '@angular/core'\nimport { CommonModule } from '@angular/common'\nimport { FormsModule } from '@angular/forms'\n\nimport { IonicModule } from '@ionic/angular'\n\nimport { HealthCheckPageRoutingModule } from './health-check-routing.module'\n\nimport { HealthCheckPage } from './health-check.page'\nimport { TranslateModule } from '@ngx-translate/core'\n\n@NgModule({\n  imports: [CommonModule, FormsModule, IonicModule, TranslateModule, HealthCheckPageRoutingModule],\n  declarations: [HealthCheckPage]\n})\nexport class HealthCheckPageModule {}\n","import { MainProtocolSymbols, ProtocolSymbols } from '@airgap/coinlib-core'\nimport { Component } from '@angular/core'\nimport { LoadingController } from '@ionic/angular'\nimport { TranslateService } from '@ngx-translate/core'\nimport { ApiHealth, CoinlibService } from 'src/app/services/coinlib/coinlib.service'\n\nenum CheckStatus {\n  LOADING = 'loading',\n  PENDING = 'pending',\n  SUCCESS = 'success',\n  FAIL = 'fail'\n}\n\nenum ApiType {\n  NODE = 'node',\n  Explorer = 'explorer'\n}\n\ninterface CheckItem {\n  title: string\n  status: CheckStatus\n  delay: number\n  check: () => Promise<boolean>\n}\n\n// TODO: Should be provided by the API\nconst rskHealthMock = {\n  identifier: MainProtocolSymbols.RBTC,\n  node: { isHealthy: true },\n  explorer: { isHealthy: true }\n}\n\n@Component({\n  selector: 'app-health-check',\n  templateUrl: './health-check.page.html',\n  styleUrls: ['./health-check.page.scss']\n})\nexport class HealthCheckPage {\n  items: CheckItem[]\n  private loadingElement: HTMLIonLoadingElement\n\n  public apiHealth: ApiHealth[]\n\n  constructor(\n    private readonly coinlibService: CoinlibService,\n    private readonly loadingController: LoadingController,\n    private readonly translateService: TranslateService\n  ) {\n    this.items = [\n      this.generateCheckItem('Tezos', MainProtocolSymbols.XTZ, ApiType.NODE),\n      this.generateCheckItem('Tezos', MainProtocolSymbols.XTZ, ApiType.Explorer),\n      this.generateCheckItem('Bitcoin', MainProtocolSymbols.BTC, ApiType.NODE),\n      this.generateCheckItem('Ethereum', MainProtocolSymbols.ETH, ApiType.NODE),\n      this.generateCheckItem('Ethereum', MainProtocolSymbols.ETH, ApiType.Explorer),\n      this.generateCheckItem('RSK', MainProtocolSymbols.RBTC, ApiType.NODE),\n      this.generateCheckItem('RSK', MainProtocolSymbols.RBTC, ApiType.Explorer),\n      this.generateCheckItem('Polkadot', MainProtocolSymbols.POLKADOT, ApiType.NODE),\n      this.generateCheckItem('Polkadot', MainProtocolSymbols.POLKADOT, ApiType.Explorer),\n      this.generateCheckItem('Kusama', MainProtocolSymbols.KUSAMA, ApiType.NODE),\n      this.generateCheckItem('Kusama', MainProtocolSymbols.KUSAMA, ApiType.Explorer),\n      this.generateCheckItem('Cosmos', MainProtocolSymbols.COSMOS, ApiType.NODE),\n      this.generateCheckItem('Aeternity', MainProtocolSymbols.AE, ApiType.NODE),\n      this.generateCheckItem('Groestlcoin', MainProtocolSymbols.GRS, ApiType.NODE)\n    ]\n  }\n\n  public async ionViewWillEnter() {\n    this.displayLoading()\n    this.coinlibService.checkApiHealth().then((apiHealth) => {\n      this.apiHealth = apiHealth.concat(rskHealthMock) // TODO: Api result instead of mock\n      this.loadingElement?.dismiss()\n      this.runChecks()\n    })\n  }\n\n  public async displayLoading(): Promise<void> {\n    this.loadingElement = await this.loadingController.create({\n      message: this.translateService.instant('health-check.message'),\n      backdropDismiss: true\n    })\n    await this.loadingElement.present()\n  }\n\n  private generateCheckItem(protocolName: string, identifier: ProtocolSymbols, apiType: ApiType) {\n    return {\n      title: apiType === ApiType.NODE ? `${protocolName} Node` : `${protocolName} Explorer`,\n      status: CheckStatus.LOADING,\n      delay: 100,\n      check: async () => {\n        return this.isHealthy(identifier, apiType)\n      }\n    }\n  }\n\n  private async isHealthy(identifier: ProtocolSymbols, apiType: ApiType) {\n    const healthInfo = this.apiHealth.find((el) => el.identifier === identifier)\n    return healthInfo[apiType].isHealthy\n  }\n\n  private async runChecks() {\n    this.items.forEach((item) => (item.status = CheckStatus.LOADING))\n    for (let i = 0; i < this.items.length; i++) {\n      const element = this.items[i]\n      element.status = CheckStatus.PENDING\n      await new Promise((resolve) => setTimeout(resolve, element.delay))\n      element.status = (await element.check()) ? CheckStatus.SUCCESS : CheckStatus.FAIL\n      await new Promise((resolve) => setTimeout(resolve, 100))\n    }\n  }\n}\n","<ion-header class=\"ion-no-border\">\n  <ion-grid fixed=\"true\" class=\"ion-no-padding\">\n    <ion-toolbar>\n      <ion-buttons slot=\"start\">\n        <ion-back-button defaultHref=\"/tabs/settings\"></ion-back-button>\n      </ion-buttons>\n      <ion-title>{{ 'health-check.title' | translate }}</ion-title>\n    </ion-toolbar>\n  </ion-grid>\n</ion-header>\n\n<ion-content>\n  <ion-grid fixed=\"true\" class=\"ion-no-padding\">\n    <ion-list>\n      <ion-card *ngFor=\"let item of items\">\n        <ion-card-header>\n          <ion-item lines=\"none\">\n            <ion-card-title>{{item.title}}</ion-card-title>\n            <ion-buttons slot=\"end\">\n              <ion-button shape=\"round\" size=\"small\" color=\"secondary\">\n                <ion-spinner name=\"lines-small\" color=\"primary\" *ngIf=\"item.status === 'pending'\"></ion-spinner>\n                <span *ngIf=\"item.status === 'loading'\">{{item.status}}</span>\n                <span *ngIf=\"item.status === 'fail'\"><ion-icon size=\"large\" color=\"danger\" name=\"close-circle\"></ion-icon></span>\n                <span *ngIf=\"item.status === 'success'\">\n                  <ion-icon size=\"large\" color=\"success\" name=\"checkmark-circle-outline\"></ion-icon>\n                </span>\n              </ion-button>\n            </ion-buttons>\n          </ion-item>\n        </ion-card-header>\n      </ion-card>\n    </ion-list>\n  </ion-grid>\n</ion-content>\n"],"sourceRoot":"webpack:///"}