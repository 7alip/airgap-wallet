(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{awK3:function(t,e,n){"use strict";n.r(e),n.d(e,"LedgerSignPageModule",function(){return P});var r=n("138U"),i=n("ofXK"),o=n("tyNb"),a=n("TEn/"),s=n("sYmb"),c=n("j1ZV"),l=n("iTUp"),b=n("mrSG"),u=n("RKiA"),d=n("kB5k"),g=n.n(d),h=n("1y+R"),p=n("z26V"),f=n("hPkG"),m=n("fXoL"),w=function(t){return{protocol:t,maxDigits:void 0}},v=function(t){return{protocol:t}};function T(t,e){if(1&t&&(m.Ob(0),m.Qb(1,"ion-row",9),m.Qb(2,"ion-col",10),m.Qb(3,"h5"),m.wc(4),m.bc(5,"async"),m.bc(6,"amountConverter"),m.Pb(),m.Pb(),m.Qb(7,"ion-col",10),m.Qb(8,"h5"),m.wc(9),m.Pb(),m.Pb(),m.Qb(10,"ion-col",10),m.Qb(11,"h5"),m.wc(12),m.bc(13,"async"),m.bc(14,"feeConverter"),m.Pb(),m.Pb(),m.Qb(15,"ion-col",11),m.Qb(16,"small"),m.wc(17,"Amount"),m.Pb(),m.Pb(),m.Qb(18,"ion-col",11),m.Qb(19,"small"),m.wc(20,"Operations"),m.Pb(),m.Pb(),m.Qb(21,"ion-col",11),m.Qb(22,"small"),m.wc(23,"Fee"),m.Pb(),m.Pb(),m.Pb(),m.Nb()),2&t){var n=m.ac();m.Ab(4),m.yc(" ",m.cc(5,3,m.dc(6,5,n.aggregatedInfo.totalAmount.toFixed(),m.kc(13,w,n.airGapTxs[0].protocolIdentifier)))," "),m.Ab(5),m.xc(n.aggregatedInfo.numberOfTxs),m.Ab(3),m.xc(m.cc(13,8,m.dc(14,10,n.aggregatedInfo.totalFees.toFixed(),m.kc(15,v,n.airGapTxs[0].protocolIdentifier))))}}function x(t,e){1&t&&m.Mb(0,"airgap-from-to",13),2&t&&m.gc("transaction",e.$implicit)}function O(t,e){if(1&t&&(m.Ob(0),m.uc(1,x,1,1,"airgap-from-to",12),m.Nb()),2&t){var n=m.ac();m.Ab(1),m.gc("ngForOf",n.airGapTxs)}}var I=function(t){return{title:t}},y=function(){function t(t,e,n,r,i,o,a){var s=this;if(this.router=t,this.route=e,this.dataService=n,this.alertCtrl=r,this.loadingController=i,this.translateService=o,this.ledgerService=a,this.wallet=null,this.airGapTxs=null,this.route.snapshot.data.special){var c=this.route.snapshot.data.special;this.wallet=c.wallet,this.airGapTxs=c.airGapTxs,this.unsignedTx=c.data,this.airGapTxs.length>1&&this.airGapTxs.every(function(t){return t.protocolIdentifier===s.airGapTxs[0].protocolIdentifier})&&(this.aggregatedInfo={numberOfTxs:this.airGapTxs.length,totalAmount:this.airGapTxs.map(function(t){return new g.a(t.amount)}).filter(function(t){return!t.isNaN()}).reduce(function(t,e){return t.plus(e)},new g.a(0)),totalFees:this.airGapTxs.reduce(function(t,e){return t.plus(e.fee)},new g.a(0))},console.log("aggregatedInfo",this.aggregatedInfo))}this.connectWithLedger()}return t.prototype.connectWithLedger=function(){return Object(b.b)(this,void 0,void 0,function(){var t;return Object(b.e)(this,function(e){switch(e.label){case 0:return[4,this.showLoader("Connecting device...")];case 1:e.sent(),e.label=2;case 2:return e.trys.push([2,4,5,6]),[4,this.ledgerService.openConnection(this.wallet.protocol.identifier)];case 3:return e.sent(),[3,6];case 4:return t=e.sent(),console.warn(t),this.promptError(t),[3,6];case 5:return this.dismissLoader(),[7];case 6:return[2]}})})},t.prototype.signTx=function(){return Object(b.b)(this,void 0,void 0,function(){var t,e,n;return Object(b.e)(this,function(r){switch(r.label){case 0:return[4,this.showLoader("Signing transaction...")];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,4,5,6]),[4,this.ledgerService.signTransaction(this.wallet.protocol.identifier,this.unsignedTx)];case 3:return t=r.sent(),e={id:Object(u.generateId)(10),type:u.IACMessageType.MessageSignResponse,protocol:this.wallet.protocol.identifier,payload:{transaction:t,accountIdentifier:this.wallet.publicKey.substr(-6)}},this.dataService.setData(h.b.TRANSACTION,{messageDefinitionObjects:[e]}),this.router.navigateByUrl("/transaction-confirm/"+h.b.TRANSACTION).catch(Object(f.b)(f.a.NAVIGATION)),[3,6];case 4:return n=r.sent(),console.warn(n),this.promptError(n),[3,6];case 5:return this.dismissLoader(),[7];case 6:return[2]}})})},t.prototype.promptError=function(t){return Object(b.b)(this,void 0,void 0,function(){var e;return Object(b.e)(this,function(n){switch(n.label){case 0:if("string"==typeof t){if("Rejected"===t)return[2];e=t}else e=t instanceof Error?t.message:this.translateService.instant("ledger-sign.error-alert.unknown");return[4,this.alertCtrl.create({header:this.translateService.instant("ledger-sign.error-alert.header"),message:e,buttons:[{text:this.translateService.instant("ledger-sign.error-alert.confirm")}]})];case 1:return n.sent().present().catch(Object(f.b)(f.a.IONIC_ALERT)),[2]}})})},t.prototype.showLoader=function(t){return Object(b.b)(this,void 0,void 0,function(){var e;return Object(b.e)(this,function(n){switch(n.label){case 0:return this.dismissLoader(),e=this,[4,this.loadingController.create({message:t})];case 1:return e.loader=n.sent(),[4,this.loader.present().catch(Object(f.b)(f.a.IONIC_LOADER))];case 2:return n.sent(),[2]}})})},t.prototype.dismissLoader=function(){this.loader&&(this.loader.dismiss().catch(Object(f.b)(f.a.IONIC_LOADER)),this.loader=null)},t.\u0275fac=function(e){return new(e||t)(m.Lb(o.g),m.Lb(o.a),m.Lb(h.a),m.Lb(a.a),m.Lb(a.kb),m.Lb(s.d),m.Lb(p.a))},t.\u0275cmp=m.Fb({type:t,selectors:[["page-ledger-sign"]],decls:20,vars:16,consts:[[1,"ion-no-border"],["fixed","true",1,"ion-no-padding"],["slot","start"],["defaultHref","/"],[1,"ion-padding","ion-margin-bottom"],[3,"innerHTML"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["id","confirm","size","default","color","primary","shape","round",3,"click"],[1,"ion-padding-bottom","ion-text-center"],["size","4",1,"content--align__center-center"],["size","4"],["class","ion-padding-horizontal",3,"transaction",4,"ngFor","ngForOf"],[1,"ion-padding-horizontal",3,"transaction"]],template:function(t,e){1&t&&(m.Qb(0,"ion-header",0),m.Qb(1,"ion-grid",1),m.Qb(2,"ion-toolbar"),m.Qb(3,"ion-buttons",2),m.Mb(4,"ion-back-button",3),m.Pb(),m.Qb(5,"ion-title"),m.wc(6),m.bc(7,"translate"),m.bc(8,"uppercase"),m.Pb(),m.Pb(),m.Pb(),m.Pb(),m.Qb(9,"ion-content",4),m.Qb(10,"ion-grid",1),m.Qb(11,"ion-row"),m.Mb(12,"h5",5),m.bc(13,"translate"),m.Pb(),m.uc(14,T,24,17,"ng-container",6),m.uc(15,O,2,1,"ng-container",6),m.Pb(),m.Qb(16,"ion-fab",7),m.Qb(17,"ion-button",8),m.Yb("click",function(){return e.signTx()}),m.wc(18),m.bc(19,"translate"),m.Pb(),m.Pb(),m.Pb()),2&t&&(m.Ab(6),m.xc(m.dc(7,5,"ledger-sign.title",m.kc(14,I,m.cc(8,8,e.wallet.protocol.identifier)))),m.Ab(6),m.gc("innerHTML",m.cc(13,10,"ledger-sign.text"),m.pc),m.Ab(2),m.gc("ngIf",e.airGapTxs&&e.airGapTxs.length>1),m.Ab(1),m.gc("ngIf",e.airGapTxs),m.Ab(3),m.yc(" ",m.cc(19,12,"ledger-sign.confirm_label")," "))},directives:[a.v,a.u,a.hb,a.j,a.f,a.g,a.fb,a.q,a.R,i.n,a.r,a.i,a.p,i.m,r.o],pipes:[s.c,i.r,i.b,r.g,r.n],styles:[""]}),t}(),P=function(){function t(){}return t.\u0275mod=m.Jb({type:t}),t.\u0275inj=m.Ib({factory:function(e){return new(e||t)},imports:[[a.ib,i.c,c.a,s.b,l.a,r.e,o.j.forChild([{path:"",component:y}])]]}),t}()}}]);